# üìä Project: Customer Churn Prediction & Segmentation for an E-Commerce Company | Python, Machine Learning

## üìë Table of Contents
1. [Background & Overview](#background--overview)
2. [Dataset Description & Data Structure](#dataset-description--data-structure)
3. [Main Process](#main-process)
4. [Final Conclusion & Recommendations](#final-conclusion--recommendations)

---

## Background & Overview

## üéØ Objective:
D·ª± √°n n√†y nh·∫±m ph√¢n t√≠ch h√†nh vi kh√°ch h√†ng v√† d·ª± ƒëo√°n kh·∫£ nƒÉng r·ªùi b·ªè d·ªãch v·ª• (**churn**). D·ª±a tr√™n d·ªØ li·ªáu giao d·ªãch c·ªßa kh√°ch h√†ng, ch√∫ng t√¥i mu·ªën:

‚úîÔ∏è X√°c ƒë·ªãnh c√°c y·∫øu t·ªë ·∫£nh h∆∞·ªüng ƒë·∫øn vi·ªác kh√°ch h√†ng r·ªùi b·ªè d·ªãch v·ª•.  
‚úîÔ∏è Cung c·∫•p c√°c insight gi√∫p doanh nghi·ªáp tƒÉng retention rate.  
‚úîÔ∏è X√¢y d·ª±ng m√¥ h√¨nh Machine Learning ƒë·ªÉ d·ª± ƒëo√°n churn.  

## üë§ Who is this project for?
‚úîÔ∏è Data Analysts & Business Analysts.  
‚úîÔ∏è C√°c nh√† qu·∫£n l√Ω v√† chi·∫øn l∆∞·ª£c kinh doanh.  
‚úîÔ∏è B·ªô ph·∫≠n Marketing & CSKH ƒë·ªÉ t·ªëi ∆∞u chi·∫øn l∆∞·ª£c gi·ªØ ch√¢n kh√°ch h√†ng.  

---

## Dataset Description & Data Structure

## üìå Data Source
- **Ngu·ªìn**: Cung c·∫•p b·ªüi c√¥ng ty Ecommerce.
- **ƒê·ªãnh d·∫°ng**: `.xlsx`
- **K√≠ch th∆∞·ªõc**: D·ªØ li·ªáu g·ªìm 5630 d√≤ng v√† 20 c·ªôt d·ªØ li·ªáu

## üìä Data Structure & Relationships
## 1Ô∏è‚É£ **Tables Used**
- **Dataset ch√≠nh**: Ch·ª©a th√¥ng tin c·ªßa kh√°ch h√†ng, ƒë∆°n h√†ng, v√† c√°c ƒë·∫∑c ƒëi·ªÉm kh√°c.

## 2Ô∏è‚É£ **Table Schema & Data Snapshot**
| T√™n C·ªôt                          | Ki·ªÉu D·ªØ Li·ªáu | M√¥ T·∫£                                              |
|-----------------------------------|-------------|----------------------------------------------------|
| `CustomerID`                     | INT         | ID duy nh·∫•t c·ªßa kh√°ch h√†ng                         |
| `Churn`                          | INT         | C·ªù churn (1 = r·ªùi b·ªè, 0 = ho·∫°t ƒë·ªông)               |
| `Tenure`                         | INT         | S·ªë th√°ng kh√°ch h√†ng ƒë√£ s·ª≠ d·ª•ng d·ªãch v·ª•             |
| `PreferredLoginDevice`           | TEXT        | Thi·∫øt b·ªã ƒëƒÉng nh·∫≠p ∆∞u ti√™n c·ªßa kh√°ch h√†ng         |
| `CityTier`                       | INT         | Ph√¢n lo·∫°i th√†nh ph·ªë                                |
| `WarehouseToHome`                | FLOAT       | Kho·∫£ng c√°ch t·ª´ kho ƒë·∫øn nh√† kh√°ch h√†ng              |
| `PreferredPaymentMode`           | TEXT        | Ph∆∞∆°ng th·ª©c thanh to√°n ∆∞a th√≠ch                    |
| `Gender`                         | TEXT        | Gi·ªõi t√≠nh c·ªßa kh√°ch h√†ng                           |
| `HourSpendOnApp`                 | FLOAT       | S·ªë gi·ªù s·ª≠ d·ª•ng ·ª©ng d·ª•ng ho·∫∑c trang web             |
| `NumberOfDeviceRegistered`       | INT         | T·ªïng s·ªë thi·∫øt b·ªã ƒë√£ ƒëƒÉng k√Ω                        |
| `PreferedOrderCat`               | TEXT        | Danh m·ª•c ƒë∆°n h√†ng ∆∞a th√≠ch trong th√°ng g·∫ßn nh·∫•t    |
| `SatisfactionScore`              | INT         | ƒêi·ªÉm h√†i l√≤ng c·ªßa kh√°ch h√†ng                       |
| `MaritalStatus`                  | TEXT        | T√¨nh tr·∫°ng h√¥n nh√¢n c·ªßa kh√°ch h√†ng                 |
| `NumberOfAddress`                | INT         | T·ªïng s·ªë ƒë·ªãa ch·ªâ ƒë√£ ƒëƒÉng k√Ω                         |
| `Complain`                       | INT         | C√≥ khi·∫øu n·∫°i trong th√°ng g·∫ßn nh·∫•t hay kh√¥ng        |
| `OrderAmountHikeFromLastYear`    | FLOAT       | T·ª∑ l·ªá tƒÉng gi√° tr·ªã ƒë∆°n h√†ng so v·ªõi nƒÉm tr∆∞·ªõc       |
| `CouponUsed`                     | INT         | T·ªïng s·ªë phi·∫øu gi·∫£m gi√° ƒë√£ s·ª≠ d·ª•ng trong th√°ng g·∫ßn nh·∫•t |
| `OrderCount`                     | INT         | T·ªïng s·ªë ƒë∆°n h√†ng ƒë√£ ƒë·∫∑t trong th√°ng g·∫ßn nh·∫•t       |
| `DaySinceLastOrder`              | INT         | S·ªë ng√†y k·ªÉ t·ª´ ƒë∆°n h√†ng g·∫ßn nh·∫•t                    |
| `CashbackAmount`                 | FLOAT       | S·ªë ti·ªÅn ho√†n l·∫°i trung b√¨nh trong th√°ng g·∫ßn nh·∫•t   |

---

## Main Process

## 1Ô∏è‚É£ **Data Cleaning & Preprocessing**
- Ki·ªÉm tra d·ªØ li·ªáu thi·∫øu 
## 2Ô∏è‚É£ Missing Data Analysis

ƒê·ªÉ ki·ªÉm tra d·ªØ li·ªáu b·ªã thi·∫øu, ch√∫ng t√¥i s·ª≠ d·ª•ng h√†m sau:

<details>
<summary>Click to expand</summary>
```python
import pandas as pd

def count_NaN_values(df):
    """
    H√†m ƒë·ªÉ ƒë·∫øm s·ªë l∆∞·ª£ng gi√° tr·ªã NaN trong DataFrame.

    Tham s·ªë:
    df (pandas.DataFrame): DataFrame ƒë·ªÉ ƒë·∫øm gi√° tr·ªã NaN.
    """
    nan_dict = {}
    for col in df.columns:
        num_NaN = df[col].isna().sum()
        nan_dict[col] = num_NaN

    NaN_table = pd.DataFrame.from_dict(nan_dict, orient='index', columns=['Number of NaN']).reset_index()
    NaN_table.rename(columns={
</details>
```
- Chuy·ªÉn ƒë·ªïi ki·ªÉu d·ªØ li·ªáu ph√π h·ª£p.
Sau khi ki·ªÉm tra d·ªØ li·ªáu thi·∫øu, ch√∫ng t√¥i ti·∫øn h√†nh x·ª≠ l√Ω nh∆∞ sau:

## üìå X·ª≠ l√Ω c·ªôt `Tenure`
- V·∫Ω bi·ªÉu ƒë·ªì ph√¢n b·ªë **Tenure** theo tr·∫°ng th√°i Churn:

<details>
<summary>Click to expand</summary>
```python
import seaborn as sns
import matplotlib.pyplot as plt

# L·ªçc d·ªØ li·ªáu cho churn = 0 v√† churn = 1
churn_0 = df[df['Churn'] == 0]
churn_1 = df[df['Churn'] == 1]

column_to_plot = 'Tenure'

plt.figure(figsize=(10, 6))
sns.histplot(churn_0[column_to_plot], color='green', label='Churn = 0', kde=True, bins=30)
sns.histplot(churn_1[column_to_plot], color='red', label='Churn = 1', kde=True, bins=30)

plt.title(f'Histogram of {column_to_plot} by Churn')
plt.xlabel(column_to_plot)
plt.ylabel('Frequency')
plt.legend()
plt.show()
</details>
```

- **X·ª≠ l√Ω d·ªØ li·ªáu tr·ªëng**: Thay th·∫ø c√°c gi√° tr·ªã NaN b·∫±ng `0`:
<details>
<summary>Click to expand</summary>
```python
df['Tenure'] = df['Tenure'].fillna(0)
</details>
```
## üìå X·ª≠ l√Ω d·ªØ li·ªáu Tenure: V√¨ sao thay NaN b·∫±ng 0?

## 1Ô∏è‚É£ Gi·∫£ ƒë·ªãnh d·ªØ li·ªáu b·ªã thi·∫øu do kh√°ch h√†ng m·ªõi
- Tenure l√† s·ªë th√°ng kh√°ch h√†ng ƒë√£ g·∫Øn b√≥ v·ªõi c√¥ng ty.  
- N·∫øu gi√° tr·ªã b·ªã thi·∫øu, c√≥ th·ªÉ do kh√°ch h√†ng m·ªõi ƒëƒÉng k√Ω nh∆∞ng ch∆∞a c√≥ ƒë·ªß d·ªØ li·ªáu.  
- **Thay th·∫ø b·∫±ng 0 ph·∫£n √°nh ch√≠nh x√°c t√¨nh tr·∫°ng kh√°ch h√†ng m·ªõi.**  
üîπ *V√≠ d·ª•:* Kh√°ch h√†ng v·ª´a ƒëƒÉng k√Ω nh∆∞ng d·ªØ li·ªáu ch∆∞a c·∫≠p nh·∫≠t ‚Üí Tenure b·ªã NaN ‚Üí G√°n **0**.  

## 2Ô∏è‚É£ Tr√°nh sai l·ªách khi d√πng mean ho·∫∑c median
- N·∫øu thay NaN b·∫±ng **mean** ho·∫∑c **median**, d·ªØ li·ªáu c√≥ th·ªÉ b·ªã l·ªách.  
- Kh√°ch h√†ng m·ªõi c√≥ th·ªÉ b·ªã g√°n Tenure l·ªõn h∆°n th·ª±c t·∫ø ‚Üí D·ª± ƒëo√°n sai trong m√¥ h√¨nh Churn.  
üîπ *V√≠ d·ª•:* N·∫øu mean = 15 th√°ng, ta ƒëang gi·∫£ ƒë·ªãnh kh√°ch h√†ng ch∆∞a c√≥ d·ªØ li·ªáu ƒë√£ g·∫Øn b√≥ trung b√¨nh 15 th√°ng ‚Üí **Kh√¥ng ch√≠nh x√°c!**  

## 3Ô∏è‚É£ T∆∞∆°ng th√≠ch v·ªõi m√¥ h√¨nh ph√¢n t√≠ch Churn
- **Nh√≥m kh√°ch h√†ng m·ªõi d·ªÖ d√†ng nh·∫≠n di·ªán** khi thay NaN ‚Üí 0.  
- N·∫øu thay b·∫±ng trung b√¨nh, c√≥ th·ªÉ m·∫•t th√¥ng tin quan tr·ªçng v·ªÅ h√†nh vi c·ªßa kh√°ch h√†ng m·ªõi.  

‚úÖ **Ch·ªçn `fillna(0)` gi√∫p d·ªØ li·ªáu ch√≠nh x√°c h∆°n, tr√°nh sai l·ªách v√† h·ªó tr·ª£ ph√¢n t√≠ch t·ªët h∆°n.**
---
## üìå X·ª≠ l√Ω c·ªôt `WarehouseToHome`
- V·∫Ω bi·ªÉu ƒë·ªì ph√¢n b·ªë **WarehouseToHome** theo tr·∫°ng th√°i Churn:

<details>
<summary>Click to expand</summary>
```python
column_to_plot = 'WarehouseToHome'

plt.figure(figsize=(10, 6))
sns.histplot(churn_0[column_to_plot], color='green', label='Churn = 0', kde=True)
sns.histplot(churn_1[column_to_plot], color='red', label='Churn = 1', kde=True)

plt.title(f'Histogram of {column_to_plot} by Churn')
plt.xlabel(column_to_plot)
plt.ylabel('Frequency')
plt.legend()
plt.show()
</details>
```
- **X·ª≠ l√Ω d·ªØ li·ªáu tr·ªëng**: Thay th·∫ø c√°c gi√° tr·ªã NaN b·∫±ng gi√° tr·ªã trung v·ªã:
<details>
<summary>Click to expand</summary>
```python
df['WarehouseToHome'] = df['WarehouseToHome'].fillna(df['WarehouseToHome'].median())
</details>
```
---
## üìå X·ª≠ l√Ω c·ªôt `HourSpendOnApp`
- V·∫Ω bi·ªÉu ƒë·ªì ph√¢n b·ªë **HourSpendOnApp** theo tr·∫°ng th√°i Churn:

<details>
<summary>Click to expand</summary>
```python
column_to_plot = 'HourSpendOnApp'

plt.figure(figsize=(10, 6))
sns.histplot(churn_0[column_to_plot], color='green', label='Churn = 0', kde=True, bins=30)
sns.histplot(churn_1[column_to_plot], color='red', label='Churn = 1', kde=True, bins=30)

plt.title(f'Histogram of {column_to_plot} by Churn')
plt.xlabel(column_to_plot)
plt.ylabel('Frequency')
plt.legend()
plt.show()
</details>
```

- **X·ª≠ l√Ω d·ªØ li·ªáu tr·ªëng**: Do gi√° tr·ªã trung b√¨nh l√† **2.93**, l√†m tr√≤n th√†nh `3`:
<details>
<summary>Click to expand</summary>
```python
df['HourSpendOnApp'] = df['HourSpendOnApp'].fillna(3)
</details>
```
---
## üìå X·ª≠ l√Ω c√°c c·ªôt c√≤n l·∫°i (`OrderAmountHikeFromlastYear`, `CouponUsed`, `OrderCount`, `DaySinceLastOrder`)
- V·∫Ω bi·ªÉu ƒë·ªì ph√¢n b·ªë:

<details>
<summary>Click to expand</summary>
```python
list_nan_col = ['OrderAmountHikeFromlastYear', 'CouponUsed', 'OrderCount', 'DaySinceLastOrder']

g = sns.FacetGrid(pd.melt(df, id_vars='Churn', value_vars=list_nan_col), col="variable", col_wrap=2, height=4, sharex=False, sharey=False)
g.map_dataframe(sns.histplot, x='value', hue='Churn', kde=True, stat='density', common_norm=False, palette='Set1')

for ax, column in zip(g.axes.flat, list_nan_col):
    ax.set_title(f'Histogram of {column} by Churn')
    ax.set_xlabel(column)
    ax.set_ylabel('Density')

g.add_legend(title='Churn')

plt.tight_layout()
plt.show()
</details>
```

- **X·ª≠ l√Ω d·ªØ li·ªáu tr·ªëng**:
- Thay th·∫ø **NaN** b·∫±ng trung b√¨nh (`mean`):  
<details>
<summary>Click to expand</summary>
```python
df['OrderAmountHikeFromlastYear'] = df['OrderAmountHikeFromlastYear'].fillna(df['OrderAmountHikeFromlastYear'].median())
df['OrderCount'] = df['OrderCount'].fillna(df['OrderCount'].median())
</details>
```
üîç X·ª≠ l√Ω NaN cho `CouponUsed` v√† `DaySinceLastOrder`  
üìå L√Ω do ch·ªçn `0` thay v√¨ mean/median:  
‚úÖ **D·ªØ li·ªáu c√≥ ph√¢n b·ªë l·ªách (skewed distribution)** ‚Üí Mean kh√¥ng ph·∫£n √°nh trung th·ª±c.   
‚úÖ **Nhi·ªÅu gi√° tr·ªã `0` trong d·ªØ li·ªáu** ‚Üí NaN c√≥ kh·∫£ nƒÉng ƒë·∫°i di·ªán cho **"kh√¥ng c√≥ ho·∫°t ƒë·ªông"** thay v√¨ gi√° tr·ªã b·ªã m·∫•t.  
‚úÖ **ƒêi·ªÅn b·∫±ng `0` gi√∫p gi·ªØ nguy√™n √Ω nghƒ©a th·ª±c t·∫ø c·ªßa d·ªØ li·ªáu**:  
   - **`CouponUsed = 0`** ‚Üí Kh√°ch h√†ng **ch∆∞a s·ª≠ d·ª•ng** phi·∫øu gi·∫£m gi√°.  
   - **`DaySinceLastOrder = 0`** ‚Üí Kh√°ch h√†ng **ch∆∞a t·ª´ng ƒë·∫∑t h√†ng**.  
  - Thay th·∫ø **NaN** b·∫±ng `0`:
    ```python
    df['CouponUsed'] = df['CouponUsed'].fillna(0)
    df['DaySinceLastOrder'] = df['DaySinceLastOrder'].fillna(0)
    ```
## 2Ô∏è‚É£ **Exploratory Data Analysis (EDA) and Hypothesis Testing**
## üîç Ki·ªÉm ƒë·ªãnh th·ªëng k√™ gi·ªØa c√°c bi·∫øn v√† Churn

ƒê·ªÉ ki·ªÉm tra xem c√°c bi·∫øn c√≥ ·∫£nh h∆∞·ªüng ƒë√°ng k·ªÉ ƒë·∫øn Churn hay kh√¥ng, ch√∫ng t√¥i th·ª±c hi·ªán ki·ªÉm ƒë·ªãnh th·ªëng k√™:

## üìä 1Ô∏è‚É£ Ki·ªÉm ƒë·ªãnh bi·∫øn ƒë·ªãnh l∆∞·ª£ng
- **Ph∆∞∆°ng ph√°p:**  
  - **T-test**: D√πng n·∫øu d·ªØ li·ªáu c√≥ ph√¢n ph·ªëi chu·∫©n.  
  - **Mann-Whitney U test**: D√πng n·∫øu d·ªØ li·ªáu kh√¥ng c√≥ ph√¢n ph·ªëi chu·∫©n.  
- **√ù nghƒ©a:** N·∫øu `p-value < 0.05`, c√≥ s·ª± kh√°c bi·ªát ƒë√°ng k·ªÉ gi·ªØa nh√≥m Churn v√† Non-Churn.  

## üè∑Ô∏è 2Ô∏è‚É£ Ki·ªÉm ƒë·ªãnh bi·∫øn ƒë·ªãnh t√≠nh
- **Ph∆∞∆°ng ph√°p:**  
  - **Chi-Square Test**: Ki·ªÉm tra s·ª± kh√°c bi·ªát v·ªÅ t·∫ßn su·∫•t xu·∫•t hi·ªán gi·ªØa hai nh√≥m.  
  - **Cramer‚Äôs V**: ƒêo l∆∞·ªùng m·ª©c ƒë·ªô ·∫£nh h∆∞·ªüng c·ªßa bi·∫øn ƒë·ªãnh t√≠nh l√™n Churn.  
- **√ù nghƒ©a:** N·∫øu `p-value < 0.05`, bi·∫øn n√†y c√≥ ·∫£nh h∆∞·ªüng ƒë√°ng k·ªÉ ƒë·∫øn Churn.

## üîç K·∫øt qu·∫£ ki·ªÉm ƒë·ªãnh th·ªëng k√™ bi·∫øn ƒë·ªãnh l∆∞·ª£ng v√† Churn

| **Bi·∫øn**                     | **p-value**         | **Effect Size** |
|------------------------------|--------------------|----------------|
| **Tenure**                   | 2.70 √ó 10‚Åª¬π‚Åπ‚Å¥     | 0.92 (R·∫•t l·ªõn) |
| **Complain**                 | 1.31 √ó 10‚Åª‚Å∑‚Å∏     | 0.67 (L·ªõn)     |
| **CashbackAmount**           | 2.52 √ó 10‚Åª¬≥‚Å∏     | 0.41 (Trung b√¨nh - l·ªõn) |
| **DaySinceLastOrder**        | 2.85 √ó 10‚Åª¬≥‚Å∏     | 0.40 (Trung b√¨nh - l·ªõn) |
| **SatisfactionScore**        | 3.75 √ó 10‚Åª¬π‚Åµ     | 0.28 (Trung b√¨nh) |
| **NumberOfDeviceRegistered** | 3.05 √ó 10‚Åª¬π‚Å¥     | 0.29 (Trung b√¨nh) |
| **CityTier**                 | 1.62 √ó 10‚Åª¬π‚Å∞     | 0.23 (Nh·ªè - Trung b√¨nh) |
| **WarehouseToHome**          | 2.04 √ó 10‚Åª‚Åπ      | 0.18 (Nh·ªè) |
| **OrderCount**               | 2.21 √ó 10‚Åª¬≥      | 0.076 (R·∫•t nh·ªè) |
| **NumberOfAddress**          | 3.05 √ó 10‚Åª¬≤      | 0.12 (R·∫•t nh·ªè) |
| **OrderAmountHikeFromLastYear** | 7.54 √ó 10‚Åª¬≤  | 0.027 (Kh√¥ng ƒë√°ng k·ªÉ) |
| **CustomerID**               | 1.52 √ó 10‚Åª¬π      | 0.051 (Kh√¥ng ƒë√°ng k·ªÉ) |
| **HourSpendOnApp**           | 2.09 √ó 10‚Åª¬π      | 0.050 (Kh√¥ng ƒë√°ng k·ªÉ) |
| **CouponUsed**               | 4.49 √ó 10‚Åª¬π      | 0.020 (Kh√¥ng ƒë√°ng k·ªÉ) |

## üîç K·∫øt lu·∫≠n ki·ªÉm ƒë·ªãnh bi·∫øn ƒë·ªãnh l∆∞·ª£ng v√† Churn

## üìå 1Ô∏è‚É£ Bi·∫øn c√≥ ·∫£nh h∆∞·ªüng m·∫°nh ƒë·∫øn Churn (p-value r·∫•t nh·ªè, effect size l·ªõn > 0.4)
‚úÖ **Tenure** (p = 2.7 √ó 10‚Åª¬π‚Åπ‚Å¥, effect size = 0.92) ‚Üí ·∫¢nh h∆∞·ªüng r·∫•t l·ªõn ƒë·∫øn Churn.  
‚úÖ **Complain** (p = 1.3 √ó 10‚Åª‚Å∑‚Å∏, effect size = 0.67) ‚Üí Kh√°ch h√†ng c√≥ khi·∫øu n·∫°i c√≥ xu h∆∞·ªõng r·ªùi b·ªè cao.  
‚úÖ **CashbackAmount** (p = 2.5 √ó 10‚Åª¬≥‚Å∏, effect size = 0.41) ‚Üí S·ªë ti·ªÅn ho√†n l·∫°i ·∫£nh h∆∞·ªüng ƒë·∫øn Churn.  
‚úÖ **DaySinceLastOrder** (p = 2.8 √ó 10‚Åª¬≥‚Å∏, effect size = 0.40) ‚Üí Kh√°ch h√†ng c√†ng l√¢u kh√¥ng mua h√†ng c√†ng d·ªÖ r·ªùi b·ªè.  

## üìå 2Ô∏è‚É£ Bi·∫øn c√≥ ·∫£nh h∆∞·ªüng trung b√¨nh ƒë·∫øn Churn (p-value nh·ªè, effect size t·ª´ 0.2 - 0.4)
üîπ **SatisfactionScore** (p = 3.75 √ó 10‚Åª¬π‚Åµ, effect size = 0.28) ‚Üí ƒêi·ªÉm h√†i l√≤ng th·∫•p l√†m tƒÉng t·ª∑ l·ªá Churn.  
üîπ **NumberOfDeviceRegistered** (p = 3.05 √ó 10‚Åª¬π‚Å¥, effect size = 0.29) ‚Üí Kh√°ch h√†ng ƒëƒÉng k√Ω nhi·ªÅu thi·∫øt b·ªã c√≥ t·ª∑ l·ªá Churn th·∫•p h∆°n.  
üîπ **CityTier** (p = 1.61 √ó 10‚Åª¬π‚Å∞, effect size = 0.22) ‚Üí T·∫ßng l·ªõp th√†nh ph·ªë ·∫£nh h∆∞·ªüng ƒë·∫øn Churn.  
üîπ **WarehouseToHome** (p = 2.04 √ó 10‚Åª‚Åπ, effect size = 0.18) ‚Üí Kho·∫£ng c√°ch t·ª´ kho ƒë·∫øn nh√† c√≥ ·∫£nh h∆∞·ªüng nh·ªè ƒë·∫øn Churn.  

## üìå 3Ô∏è‚É£ Bi·∫øn c√≥ ·∫£nh h∆∞·ªüng y·∫øu ƒë·∫øn Churn (p-value > 0.01, effect size < 0.2)
üîπ **OrderCount** (p = 0.002, effect size = 0.075) ‚Üí S·ªë l∆∞·ª£ng ƒë∆°n h√†ng c√≥ ·∫£nh h∆∞·ªüng nh·ªè ƒë·∫øn Churn.  
üîπ **NumberOfAddress** (p = 0.03, effect size = 0.11) ‚Üí S·ªë ƒë·ªãa ch·ªâ ƒë∆∞·ª£c l∆∞u c√≥ ·∫£nh h∆∞·ªüng nh·ªè.  
üîπ **OrderAmountHikeFromLastYear** (p = 0.075, effect size = 0.02) ‚Üí Kh√¥ng c√≥ √Ω nghƒ©a th·ªëng k√™ m·∫°nh.  

## üìå 4Ô∏è‚É£ Bi·∫øn kh√¥ng c√≥ ·∫£nh h∆∞·ªüng ƒë√°ng k·ªÉ ƒë·∫øn Churn (p-value > 0.05)
‚ùå **CustomerID** (p = 0.152) ‚Üí Kh√¥ng c√≥ √Ω nghƒ©a trong d·ª± ƒëo√°n Churn.  
‚ùå **HourSpendOnApp** (p = 0.209) ‚Üí Th·ªùi gian s·ª≠ d·ª•ng app kh√¥ng ·∫£nh h∆∞·ªüng nhi·ªÅu ƒë·∫øn Churn.  
‚ùå **CouponUsed** (p = 0.449) ‚Üí S·ª≠ d·ª•ng coupon kh√¥ng c√≥ m·ªëi quan h·ªá ƒë√°ng k·ªÉ v·ªõi Churn.  
---
## üìå K·∫øt lu·∫≠n chung v·ªÅ bi·∫øn ƒë·ªãnh l∆∞·ª£ng
‚úÖ **C√°c bi·∫øn ·∫£nh h∆∞·ªüng m·∫°nh ƒë·∫øn Churn:** `Tenure`, `Complain`, `CashbackAmount`, `DaySinceLastOrder`.  
‚úÖ **C√°c bi·∫øn c√≥ ·∫£nh h∆∞·ªüng trung b√¨nh:** `SatisfactionScore`, `NumberOfDeviceRegistered`, `CityTier`, `WarehouseToHome`.  
‚úÖ **C√°c bi·∫øn c√≥ ·∫£nh h∆∞·ªüng y·∫øu ho·∫∑c kh√¥ng ƒë√°ng k·ªÉ:** `OrderCount`, `NumberOfAddress`, `OrderAmountHikeFromLastYear`, `HourSpendOnApp`, `CouponUsed`.  

## üîç K·∫øt qu·∫£ ki·ªÉm ƒë·ªãnh th·ªëng k√™ bi·∫øn ƒë·ªãnh t√≠nh v√† Churn

| **Bi·∫øn**                     | **p-value**         | **Cram√©r's V** | **M·ª©c ƒë·ªô ·∫£nh h∆∞·ªüng** |
|------------------------------|--------------------|---------------|---------------------|
| **PreferedOrderCat**         | 2.77 √ó 10‚Åª‚Å∂‚Å∞      | 0.226         | ·∫¢nh h∆∞·ªüng trung b√¨nh |
| **MaritalStatus**            | 1.07 √ó 10‚Åª‚Å¥¬π      | 0.183         | ·∫¢nh h∆∞·ªüng nh·ªè - trung b√¨nh |
| **PreferredLoginDevice**     | 1.08 √ó 10‚Åª¬π‚Å∂      | 0.114         | ·∫¢nh h∆∞·ªüng nh·ªè |
| **PreferredPaymentMode**     | 9.71 √ó 10‚Åª¬π‚Åµ      | 0.118         | ·∫¢nh h∆∞·ªüng nh·ªè |
| **Gender**                   | 3.08 √ó 10‚Åª¬≤       | 0.029         | Kh√¥ng ƒë√°ng k·ªÉ |
---
## üìå K·∫øt lu·∫≠n:
- **Bi·∫øn c√≥ ·∫£nh h∆∞·ªüng trung b√¨nh ƒë·∫øn Churn:** `PreferedOrderCat`, `MaritalStatus`.  
- **Bi·∫øn c√≥ ·∫£nh h∆∞·ªüng nh·ªè ƒë·∫øn Churn:** `PreferredLoginDevice`, `PreferredPaymentMode`.  
- **Bi·∫øn kh√¥ng c√≥ ·∫£nh h∆∞·ªüng ƒë√°ng k·ªÉ:** `Gender`.  
![image](https://github.com/user-attachments/assets/e7c2eb4e-f8f2-4d3e-bd5b-4951acbf8f32)
# Th·ªëng k√™ m√¥ t·∫£ Violin Plot (Tenure vs Churn)

## Churn = 0 (Kh√¥ng r·ªùi b·ªè):
- Tenure tr·∫£i r·ªông t·ª´ 0 ƒë·∫øn h∆°n 60 th√°ng.
- Ph·∫ßn l·ªõn kh√°ch h√†ng c√≥ Tenure d∆∞·ªõi 30 th√°ng.
- Ph√¢n b·ªë r·ªông v√† c√≥ nhi·ªÅu gi√° tr·ªã cao.

## Churn = 1 (R·ªùi b·ªè):
- Tenure ch·ªß y·∫øu t·∫≠p trung d∆∞·ªõi 10 th√°ng.
- √çt kh√°ch h√†ng c√≥ Tenure cao.
- Ph√¢n b·ªë h·∫πp, l·ªách v·ªÅ ph√≠a gi√° tr·ªã th·∫•p.  


# üìä Ma tr·∫≠n Churn vs Complain

|                     | Kh√¥ng khi·∫øu n·∫°i (0) | C√≥ khi·∫øu n·∫°i (1) |
|---------------------|-----------------|-----------------|
| **Kh√¥ng r·ªùi b·ªè (0)** | 3586            | 1096            |
| **R·ªùi b·ªè (1)**       | 440             | 508             |

## üìå Nh·∫≠n x√©t
- **Ph·∫ßn l·ªõn kh√°ch h√†ng kh√¥ng r·ªùi b·ªè (Churn = 0)** thu·ªôc nh√≥m **kh√¥ng khi·∫øu n·∫°i (3586 ng∆∞·ªùi)**.  
- **Kh√°ch h√†ng c√≥ khi·∫øu n·∫°i (Complain = 1)** c√≥ t·ª∑ l·ªá r·ªùi b·ªè cao h∆°n:  
  - **508 kh√°ch h√†ng** r·ªùi b·ªè sau khi khi·∫øu n·∫°i.  
  - So v·ªõi ch·ªâ **440 kh√°ch h√†ng** r·ªùi b·ªè m√† kh√¥ng khi·∫øu n·∫°i.  
- **T√≥m l·∫°i**, khi·∫øu n·∫°i c√≥ th·ªÉ l√† m·ªôt d·∫•u hi·ªáu b√°o tr∆∞·ªõc v·ªÅ churn, nh∆∞ng kh√¥ng ph·∫£i t·∫•t c·∫£ kh√°ch h√†ng khi·∫øu n·∫°i ƒë·ªÅu r·ªùi b·ªè.

![image](https://github.com/user-attachments/assets/bc593a14-f9bc-44dd-b09b-880498acb57f)
![image](https://github.com/user-attachments/assets/d4be2b44-b30d-4472-b716-563a2dbf575f)

# Ph√¢n t√≠ch Boxplot: CashbackAmount vs Churn

## 1. T·ªïng quan
Bi·ªÉu ƒë·ªì h·ªôp (boxplot) d∆∞·ªõi ƒë√¢y th·ªÉ hi·ªán ph√¢n ph·ªëi c·ªßa **CashbackAmount** theo tr·∫°ng th√°i **Churn** (r·ªùi b·ªè ho·∫∑c kh√¥ng r·ªùi b·ªè).

![Boxplot CashbackAmount vs Churn](image.png)

## 2. Nh·∫≠n x√©t
- **Churn = 0 (Kh√¥ng r·ªùi b·ªè)**  
  - Kho·∫£ng ph√¢n v·ªã 50% (IQR) c·ªßa CashbackAmount n·∫±m trong kho·∫£ng **~120 ƒë·∫øn ~200**.  
  - C√≥ m·ªôt s·ªë gi√° tr·ªã ngo·∫°i l·ªá r·∫•t cao, l√™n ƒë·∫øn **h∆°n 300**.  
  - Trung v·ªã (median) cao h∆°n so v·ªõi nh√≥m Churn = 1.  

- **Churn = 1 (R·ªùi b·ªè)**  
  - Kho·∫£ng IQR th·∫•p h∆°n, n·∫±m trong kho·∫£ng **~100 ƒë·∫øn ~160**.  
  - Trung v·ªã c·ªßa nh√≥m n√†y th·∫•p h∆°n nh√≥m kh√¥ng r·ªùi b·ªè.  
  - C√≥ nhi·ªÅu gi√° tr·ªã ngo·∫°i l·ªá nh∆∞ng th·∫•p h∆°n so v·ªõi nh√≥m Churn = 0.  

## 3. K·∫øt lu·∫≠n
- Nh√¨n chung, kh√°ch h√†ng kh√¥ng r·ªùi b·ªè (**Churn = 0**) c√≥ xu h∆∞·ªõng nh·∫≠n **CashbackAmount cao h∆°n**.  
- Nh√≥m kh√°ch h√†ng r·ªùi b·ªè (**Churn = 1**) nh·∫≠n cashback th·∫•p h∆°n, nh∆∞ng v·∫´n c√≥ m·ªôt s·ªë tr∆∞·ªùng h·ª£p ngo·∫°i l·ªá.  
- ƒêi·ªÅu n√†y c√≥ th·ªÉ g·ª£i √Ω r·∫±ng **vi·ªác ho√†n ti·ªÅn nhi·ªÅu c√≥ th·ªÉ gi√∫p gi·ªØ ch√¢n kh√°ch h√†ng**, nh∆∞ng c·∫ßn th√™m ph√¢n t√≠ch ƒë·ªÉ x√°c ƒë·ªãnh t√°c ƒë·ªông th·ª±c s·ª± c·ªßa cashback ƒë·∫øn churn.  

![image](https://github.com/user-attachments/assets/398e2e74-af7c-45ac-8932-0d542c35b7a9)

## üîé Ph√¢n t√≠ch Violin Plot: DaySinceLastOrder vs Churn

## 1Ô∏è‚É£ Nh√≥m Kh√¥ng R·ªùi B·ªè (Churn = 0)
- Ph·∫ßn l·ªõn kh√°ch h√†ng c√≥ `DaySinceLastOrder` th·∫•p (g·∫ßn 0), nghƒ©a l√† h·ªç th∆∞·ªùng xuy√™n ƒë·∫∑t h√†ng.
- M·ªôt s·ªë √≠t kh√°ch h√†ng c√≥ kho·∫£ng th·ªùi gian d√†i gi·ªØa c√°c l·∫ßn ƒë·∫∑t h√†ng, nh∆∞ng h·ªç v·∫´n ti·∫øp t·ª•c mua h√†ng.

## 2Ô∏è‚É£ Nh√≥m R·ªùi B·ªè (Churn = 1)
C√≥ hai nh√≥m kh√°ch h√†ng r√µ r·ªát:

## üü¢ Nh√≥m c√≥ `DaySinceLastOrder` th·∫•p:
- H·ªç v·ª´a ƒë·∫∑t h√†ng g·∫ßn ƒë√¢y nh∆∞ng v·∫´n r·ªùi b·ªè. ƒêi·ªÅu n√†y c√≥ th·ªÉ do:
  - Tr·∫£i nghi·ªám k√©m v·ªõi l·∫ßn mua cu·ªëi c√πng.
  - Khuy·∫øn m√£i ho·∫∑c ∆∞u ƒë√£i kh√¥ng c√≤n h·∫•p d·∫´n.

## üî¥ Nh√≥m c√≥ `DaySinceLastOrder` cao:
- H·ªç ƒë√£ l√¢u kh√¥ng ƒë·∫∑t h√†ng tr∆∞·ªõc khi r·ªùi b·ªè.
- ƒêi·ªÅu n√†y th∆∞·ªùng g·∫∑p ·ªü kh√°ch h√†ng m·∫•t h·ª©ng th√∫ ho·∫∑c chuy·ªÉn sang d·ªãch v·ª• kh√°c.

![image](https://github.com/user-attachments/assets/58f61245-99bf-40bc-90cc-7612f9469824)

## üìä Bi·ªÉu ƒë·ªì Thanh Ph√¢n K·ª≥ (Diverging Bar Chart) cho C√°c Bi·∫øn ƒê·ªãnh T√≠nh

## üîπ M√¥ t·∫£:
- **Bi·ªÉu ƒë·ªì thanh ph√¢n k·ª≥** gi√∫p tr·ª±c quan h√≥a m·ªëi quan h·ªá gi·ªØa c√°c bi·∫øn ƒë·ªãnh t√≠nh v√† bi·∫øn m·ª•c ti√™u `Churn`.
- C√°c thanh m√†u **xanh l√° c√¢y** ƒë·∫°i di·ªán cho kh√°ch h√†ng **kh√¥ng r·ªùi b·ªè** (`Churn = 0`).
- C√°c thanh m√†u **ƒë·ªè** ƒë·∫°i di·ªán cho kh√°ch h√†ng **r·ªùi b·ªè** (`Churn = 1`).
- Bi·ªÉu ƒë·ªì gi√∫p x√°c ƒë·ªãnh nh√≥m kh√°ch h√†ng n√†o c√≥ t·ª∑ l·ªá r·ªùi b·ªè cao h∆°n d·ª±a tr√™n t·ª´ng ƒë·∫∑c ƒëi·ªÉm c·ª• th·ªÉ.

## üîπ Code:
<details>
<summary>Click to expand</summary>
```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# Function to plot diverging bar chart
def plot_diverging_bar_chart(df, categorical_cols, target):
    for col in categorical_cols:
        # Create a cross-tabulation of counts normalized by columns to get percentages
        cross_tab = pd.crosstab(df[col], df[target], normalize='columns') * 100

        # Ensure both churn values (0 and 1) are present in the columns
        if 0 not in cross_tab.columns:
            cross_tab[0] = 0
        if 1 not in cross_tab.columns:
            cross_tab[1] = 0

        cross_tab = cross_tab[[0, 1]]  # Ensure the order of columns is [0, 1]

        # Plotting
        fig, ax = plt.subplots(figsize=(10, 6))

        # Plot bars for churn = 0
        bars0 = ax.barh(cross_tab.index, cross_tab[0], color='green', alpha=0.6, label='Churn = 0')

        # Plot bars for churn = 1
        bars1 = ax.barh(cross_tab.index, -cross_tab[1], color='red', alpha=0.6, label='Churn = 1')

        ax.set_title(f'Diverging Bar Chart for {col}')
        ax.set_xlabel('Percentage')
        ax.axvline(0, color='grey', linewidth=0.8)
        ax.legend()
        plt.show()

# Plot the charts
plot_diverging_bar_chart(df, categorical_cols, 'Churn')
</details>
```
![image](https://github.com/user-attachments/assets/885b4963-7361-44d4-bbe0-ca1ee88ab4b7)  
![image](https://github.com/user-attachments/assets/e551dbb8-a41e-4576-9408-0a887f139a31)  
![image](https://github.com/user-attachments/assets/42805c46-d446-4139-a408-ca54cf0d3856)  
![image](https://github.com/user-attachments/assets/19261fc2-d897-4c9c-9301-ae482d14c870)  
![image](https://github.com/user-attachments/assets/3c57f2c8-6b8a-4591-a9fe-54c21122d597)  


## 3Ô∏è‚É£ **SQL/Python Analysis & Machine Learning**
- **Feature Engineering**:
## Categorical Columns:
<details>
<summary>Click to expand</summary>
``` python
for c in categorical_cols:
    print(f"{c}: {df[c].unique()}")
</details>
```
 ‚úÖ Data kh√¥ng c√≥ quan h·ªá th·ª© b·∫≠c, s·ª≠ d·ª•ng one-hot encoding ƒë·ªÉ chuy·ªÉn ƒë·ªïi

 ```python
from sklearn.preprocessing import OneHotEncoder
from sklearn.compose import ColumnTransformer

# ƒê·ªãnh nghƒ©a ColumnTransformer v·ªõi OneHotEncoder cho c√°c c·ªôt ph√¢n lo·∫°i
preprocessor = ColumnTransformer(
    transformers=[
        ('cat', OneHotEncoder(), categorical_cols)
    ],
    remainder='passthrough'  # Gi·ªØ l·∫°i c√°c c·ªôt kh√¥ng ƒë∆∞·ª£c m√£ h√≥a
)

# √Åp d·ª•ng OneHotEncoder
df_encoded = preprocessor.fit_transform(df)

# Chuy·ªÉn ƒë·ªïi th√†nh DataFrame
df_encoded = pd.DataFrame(df_encoded, columns=preprocessor.get_feature_names_out())

# Lo·∫°i b·ªè ti·ªÅn t·ªë 'remainder__' trong t√™n c√°c c·ªôt
df_encoded.columns = [col.replace('remainder__', '') for col in df_encoded.columns]

print(df_encoded.columns)
<details>
<summary>Click to expand</summary>
```
## Numerical Columns:
## Data Transformation Guidelines

| Column Name                    | Transformation Method   |
|---------------------------------|-------------------------|
| **Tenure**                      | Box-Cox                 |
| **CityTier**                    | No transformation       |
| **WarehouseToHome**             | Box-Cox                 |
| **HourSpendOnApp**              | No transformation       |
| **NumberOfDeviceRegistered**    | No transformation       |
| **SatisfactionScore**           | No transformation       |
| **NumberOfAddress**             | No transformation       |
| **Complain**                    | No transformation       |
| **OrderAmountHikeFromlastYear** | No transformation       |
| **CouponUsed**                  | No transformation       |
| **OrderCount**                  | No transformation       |
| **DaySinceLastOrder**           | No transformation       |
| **CashbackAmount**              | Standard Scale          |

Ph∆∞∆°ng ph√°p Box-Cox l√† m·ªôt k·ªπ thu·∫≠t bi·∫øn ƒë·ªïi d·ªØ li·ªáu nh·∫±m c·∫£i thi·ªán t√≠nh chu·∫©n t·∫Øc (normality) c·ªßa ph√¢n ph·ªëi d·ªØ li·ªáu, gi√∫p c√°c m√¥ h√¨nh th·ªëng k√™ ho·∫∑c m√°y h·ªçc ho·∫°t ƒë·ªông hi·ªáu qu·∫£ h∆°n. Ph∆∞∆°ng ph√°p n√†y s·ª≠ d·ª•ng m·ªôt ph√©p bi·∫øn ƒë·ªïi m·∫°nh m·∫Ω, c√≥ th·ªÉ chuy·ªÉn c√°c ph√¢n ph·ªëi kh√¥ng chu·∫©n th√†nh c√°c ph√¢n ph·ªëi chu·∫©n (ho·∫∑c g·∫ßn chu·∫©n), t·ª´ ƒë√≥ gi√∫p c·∫£i thi·ªán ƒë·ªô ch√≠nh x√°c c·ªßa c√°c m√¥ h√¨nh.

V√≠ d·ª• Box cox cho Tenure
</details>
``` python
from scipy import stats

test = df['Tenure'] + 0.5

# Step 2: Apply Box-Cox transformation
transformed_data, lambda_value = stats.boxcox(test)

# Create a new DataFrame to store transformed values
df_transformed = df_encoded.copy()
df_transformed['Tenure_transformed'] = transformed_data

# Step 3: Visualize the transformation
fig, ax = plt.subplots(1, 2, figsize=(12, 4))

# Plot original data
ax[0].hist(test, bins=20, edgecolor='black')
ax[0].set_title('Original Tenure (with added 0.5)')
ax[0].set_xlabel('Values')
ax[0].set_ylabel('Frequency')

# Plot transformed data
ax[1].hist(transformed_data, bins=20, edgecolor='black')
ax[1].set_title('Box-Cox Transformed Tenure')
ax[1].set_xlabel('Transformed Values')
ax[1].set_ylabel('Frequency')

plt.tight_layout()
plt.show()

print(f"Lambda value used for transformation: {lambda_value}")
<details>
<summary>Click to expand</summary>
```
Lambda value used for transformation: -0.2843229410352237 
![image](https://github.com/user-attachments/assets/e664c4c0-db6f-4bdf-a580-0f77a80a3f5d)

- **Chia t·∫≠p d·ªØ li·ªáu**:
## üèÜ Chia D·ªØ Li·ªáu Train/Test

## üìå M√¥ t·∫£:
- Chia d·ªØ li·ªáu th√†nh t·∫≠p **hu·∫•n luy·ªán (train)** v√† **ki·ªÉm tra (test)**.
- **80% d·ªØ li·ªáu** ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ hu·∫•n luy·ªán m√¥ h√¨nh.
- **20% d·ªØ li·ªáu** ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ƒë√°nh gi√° hi·ªáu su·∫•t m√¥ h√¨nh.

## üñ•Ô∏è Code:
</details>
```python
from sklearn.model_selection import train_test_split

# Chia t·∫≠p d·ªØ li·ªáu th√†nh train (80%) v√† test (20%)
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
<details>
<summary>Click to expand</summary>
```
- **Th·ª≠ nghi·ªám c√°c m√¥ h√¨nh**:
  ‚úîÔ∏è Logistic Regression  
  ‚úîÔ∏è Random Forest
## üìå M√¥ t·∫£:
- S·ª≠ d·ª•ng **Random Forest Classifier** ƒë·ªÉ ph√¢n lo·∫°i d·ªØ li·ªáu.
- ƒê√°nh gi√° m√¥ h√¨nh d·ª±a tr√™n c√°c ch·ªâ s·ªë **accuracy, precision, recall, roc_auc_score**.
- Tr·ª±c quan h√≥a k·∫øt qu·∫£ b·∫±ng **ma tr·∫≠n nh·∫ßm l·∫´n** v√† **ƒë∆∞·ªùng cong ROC**.

## üñ•Ô∏è Code:
</details>
```python
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import roc_curve, auc, precision_score, recall_score, accuracy_score, classification_report, confusion_matrix, roc_auc_score
from sklearn.model_selection import cross_val_score
import matplotlib.pyplot as plt
import seaborn as sns

# Kh·ªüi t·∫°o m√¥ h√¨nh RandomForest
RF = RandomForestClassifier(n_estimators=100, random_state=42)

# Hu·∫•n luy·ªán m√¥ h√¨nh
RF.fit(X_train, y_train)

# D·ª± ƒëo√°n tr√™n t·∫≠p ki·ªÉm tra
y_pred = RF.predict(X_test)  # S·ªë nguy√™n: {0,1}
y_pred_prob = RF.predict_proba(X_test)[:, 1]  # X√°c su·∫•t d·ª± ƒëo√°n cho l·ªõp d∆∞∆°ng t√≠nh, s·ªë l·∫ª

# T√≠nh c√°c ch·ªâ s·ªë precision v√† recall
precision = precision_score(y_test, y_pred)
recall = recall_score(y_test, y_pred)
accuracy = accuracy_score(y_test, y_pred)
roc_auc = roc_auc_score(y_test, y_pred_prob)

# In k·∫øt qu·∫£
print(f'Accuracy: {accuracy * 100:.2f}%')
print(f'Precision: {precision * 100:.2f}%')
print(f'Recall: {recall * 100:.2f}%')
print(f'roc_auc_score: {roc_auc * 100:.2f}%')

# B·∫£ng ƒë√°nh gi√° classification report
report = classification_report(y_test, y_pred)
print("Classification Report:\n", report)

# Ma tr·∫≠n nh·∫ßm l·∫´n (Confusion Matrix)
conf_matrix = confusion_matrix(y_test, y_pred)

# V·∫Ω ma tr·∫≠n nh·∫ßm l·∫´n
plt.figure(figsize=(8, 5))
sns.heatmap(conf_matrix, annot=True, fmt='d', cmap='Blues')
plt.xlabel('Predicted')
plt.ylabel('Actual')
plt.title('Confusion Matrix')
plt.show()

# T√≠nh FPR, TPR cho ƒë∆∞·ªùng cong ROC
fpr, tpr, _ = roc_curve(y_test, y_pred_prob)

# T√≠nh AUC (Area Under the Curve)
roc_auc = auc(fpr, tpr)

# V·∫Ω ƒë∆∞·ªùng cong ROC
plt.figure()
plt.plot(fpr, tpr, color='darkorange', lw=2, label=f'ROC curve (area = {roc_auc:.2f})')
plt.plot([0, 1], [0, 1], color='navy', lw=2, linestyle='--')
plt.xlim([0.0, 1.0])
plt.ylim([0.0, 1.05])
plt.xlabel('False Positive Rate')
plt.ylabel('True Positive Rate')
plt.title('Receiver Operating Characteristic (ROC) Curve')
plt.legend(loc="lower right")
plt.show()
<details>
<summary>Click to expand</summary>
```
![image](https://github.com/user-attachments/assets/bb7a51b8-2345-4e01-b9b3-a6ddeddb9bc2)

# Ki·ªÉm tra Overfitting b·∫±ng K-Fold Cross-Validation

Trong b∆∞·ªõc n√†y, ch√∫ng ta s·ª≠ d·ª•ng **K-Fold Cross-Validation (k=5)** ƒë·ªÉ ƒë√°nh gi√° m·ª©c ƒë·ªô overfitting c·ªßa m√¥ h√¨nh **Random Forest**.

## üìå Code th·ª±c hi·ªán K-Fold Cross-Validation

</details>
```python
from sklearn.model_selection import cross_val_score
import numpy as np

# √Åp d·ª•ng k-fold cross-validation (vd: k=5) tr√™n t·∫≠p hu·∫•n luy·ªán
cv_scores = cross_val_score(RF, X_train, y_train, cv=5)

# Chuy·ªÉn ƒë·ªïi c√°c ƒëi·ªÉm s·ªë t·ª´ d·∫°ng t·ªâ l·ªá sang ph·∫ßn trƒÉm
cv_scores_percent = np.round(cv_scores * 100, 2)

# In k·∫øt qu·∫£ ƒë√°nh gi√° t·ª´ng fold d∆∞·ªõi d·∫°ng ph·∫ßn trƒÉm
print("Cross-validation scores (%):", [f"{score:.2f}%" for score in cv_scores_percent])

# In trung b√¨nh v√† ƒë·ªô l·ªách chu·∫©n c·ªßa c√°c ƒëi·ªÉm s·ªë cross-validation d∆∞·ªõi d·∫°ng ph·∫ßn trƒÉm
print(f"Mean CV score (%): {np.mean(cv_scores_percent):.2f}% +/- {np.std(cv_scores_percent):.2f}%")
<details>
<summary>Click to expand</summary>
```
# üéØ Ki·ªÉm tra Overfitting b·∫±ng K-Fold Cross-Validation

Trong b∆∞·ªõc n√†y, ch√∫ng ta s·ª≠ d·ª•ng **K-Fold Cross-Validation (k=5)** ƒë·ªÉ ƒë√°nh gi√° m·ª©c ƒë·ªô overfitting c·ªßa m√¥ h√¨nh **Random Forest**.

---

## üìå **K·∫øt qu·∫£ Cross-Validation**
Sau khi th·ª±c hi·ªán K-Fold (k=5), ch√∫ng ta thu ƒë∆∞·ª£c k·∫øt qu·∫£ sau:

</details>
```python
Cross-validation scores (%): ['94.23%', '94.34%', '96.12%', '94.01%', '96.89%']
Mean CV score (%): 95.12% +/- 1.16%
<details>
<summary>Click to expand</summary>
```
üîç Ph√¢n t√≠ch k·∫øt qu·∫£
üìå Mean CV score: 95.12% ‚Üí M√¥ h√¨nh ho·∫°t ƒë·ªông t·ªët tr√™n t·∫≠p hu·∫•n luy·ªán.
üìâ ƒê·ªô l·ªách chu·∫©n: 1.16% ‚Üí ƒêi·ªÉm s·ªë cross-validation kh√° ·ªïn ƒë·ªãnh, kh√¥ng c√≥ d·∫•u hi·ªáu r√µ r√†ng c·ªßa overfitting.
üîÑ ƒêi·ªÉm s·ªë c·ªßa t·ª´ng fold dao ƒë·ªông trong kho·∫£ng 94% - 96.89%, ƒëi·ªÅu n√†y cho th·∫•y m√¥ h√¨nh c√≥ ƒë·ªô ·ªïn ƒë·ªãnh t·ªët.

# üìä Feature Importance - ƒê√°nh gi√° t·∫ßm quan tr·ªçng c·ªßa t·ª´ng ƒë·∫∑c tr∆∞ng

Sau khi hu·∫•n luy·ªán m√¥ h√¨nh **Random Forest**, ch√∫ng ta ki·ªÉm tra m·ª©c ƒë·ªô quan tr·ªçng c·ªßa t·ª´ng ƒë·∫∑c tr∆∞ng (feature) trong d·ª± ƒëo√°n.
---
## üõ† **Th·ª±c hi·ªán**
Ch√∫ng ta s·∫Ω:
1. **L·∫•y tr·ªçng s·ªë quan tr·ªçng c·ªßa t·ª´ng ƒë·∫∑c tr∆∞ng** t·ª´ m√¥ h√¨nh Random Forest.
2. **S·∫Øp x·∫øp c√°c ƒë·∫∑c tr∆∞ng theo m·ª©c ƒë·ªô quan tr·ªçng gi·∫£m d·∫ßn**.
3. **Tr·ª±c quan h√≥a b·∫±ng bi·ªÉu ƒë·ªì c·ªôt ngang c√≥ m√†u s·∫Øc** ƒë·ªÉ d·ªÖ d√†ng ph√¢n t√≠ch.

---
## üî¢ **Code th·ª±c hi·ªán**
</details>
```python
# Get feature importances
importances = RF.feature_importances_

# Sort feature importances in descending order
indices = np.argsort(importances)[::-1]

# Rearrange feature names so they match the sorted feature importances
names = [X_train.columns[i] for i in indices]

# Define colors for the bars
palette = sns.color_palette("husl", n_colors=X_train.shape[1])  # Change "husl" to any other palette

# Plot horizontal bar chart with colored bars
plt.figure(figsize=(10, 6))
plt.barh(range(X_train.shape[1]), importances[indices], color=palette)
plt.yticks(range(X_train.shape[1]), names)
plt.title("Feature Importances")
plt.xlabel('Importance')
plt.gca().invert_yaxis()  # Invert y-axis to display most important features on top
plt.show()
<details>
<summary>Click to expand</summary>
```
![image](https://github.com/user-attachments/assets/ddd10aab-3828-4f29-8a56-691811983167)
 ‚úîÔ∏è Logistic Regression  
K·∫øt qu·∫£ cho ra nh∆∞ sau:
![image](https://github.com/user-attachments/assets/62be3875-5de7-4d63-945e-6a6efd951397)

 ‚úîÔ∏è CatBoost
 CatBoost (Categorical Boosting) l√† m·ªôt thu·∫≠t to√°n Gradient Boosting tr√™n c√¢y quy·∫øt ƒë·ªãnh (GBDT), ƒë∆∞·ª£c ph√°t tri·ªÉn b·ªüi Yandex. N√≥ ƒë·∫∑c bi·ªát t·ªëi ∆∞u cho d·ªØ li·ªáu c√≥ nhi·ªÅu bi·∫øn ph√¢n lo·∫°i (Categorical Features) m√† kh√¥ng c·∫ßn One-Hot Encoding. Tuy nhi√™n v√¨ m√¨nh ƒë√£ Encode r·ªìi n√™n v·∫´n ti·∫øp t·ª•c th·ª±c hi·ªán tr√™n b·ªô d·ªØ li·ªáu ƒë√£ encode.
## üî¢ **Code th·ª±c hi·ªán**
</details>
```python
from catboost import CatBoostClassifier
# Kh·ªüi t·∫°o m√¥ h√¨nh CatBoost
catboost = CatBoostClassifier(iterations=1000,  # s·ªë l∆∞·ª£ng c√¢y quy·∫øt ƒë·ªãnh (trees) s·∫Ω x√¢y d·ª±ng
                              learning_rate=0.1,  # t·ª∑ l·ªá h·ªçc t·∫≠p
                              depth=6,  # ƒë·ªô s√¢u c·ªßa m·ªói c√¢y
                              loss_function='Logloss',  # h√†m m·∫•t m√°t
                              eval_metric='Accuracy',  # ƒë·ªô ƒëo ƒë√°nh gi√° m√¥ h√¨nh
                              random_seed=42,  # seed ƒë·ªÉ t√°i s·∫£n sinh k·∫øt qu·∫£
                              verbose=100)  # in th√¥ng tin sau m·ªói l·∫ßn l·∫∑p

# Hu·∫•n luy·ªán m√¥ h√¨nh
catboost.fit(X_train, y_train, eval_set=(X_test, y_test), plot=True)

# D·ª± ƒëo√°n tr√™n t·∫≠p ki·ªÉm tra
y_pred = catboost.predict(X_test)  # S·ªë nguy√™n: {0,1}
y_pred_prob = catboost.predict_proba(X_test)[:, 1]  # X√°c su·∫•t d·ª± ƒëo√°n cho l·ªõp d∆∞∆°ng t√≠nh, s·ªë l·∫ª

# T√≠nh c√°c ch·ªâ s·ªë precision, recall, accuracy, v√† roc_auc
precision = precision_score(y_test, y_pred)
recall = recall_score(y_test, y_pred)
accuracy = accuracy_score(y_test, y_pred)
roc_auc = roc_auc_score(y_test, y_pred_prob)

# In k·∫øt qu·∫£
print(f'Accuracy: {accuracy * 100:.2f}%')
print(f'Precision: {precision * 100:.2f}%')
print(f'Recall: {recall * 100:.2f}%')
print(f'ROC AUC Score: {roc_auc * 100:.2f}%')

# B·∫£ng ƒë√°nh gi√° classification report
report = classification_report(y_test, y_pred)
print("Classification Report:\n", report)

# Ma tr·∫≠n nh·∫ßm l·∫´n (Confusion Matrix)
conf_matrix = confusion_matrix(y_test, y_pred)

# V·∫Ω ma tr·∫≠n nh·∫ßm l·∫´n
plt.figure(figsize=(8, 5))
sns.heatmap(conf_matrix, annot=True, fmt='d', cmap='Blues')
plt.xlabel('Predicted')
plt.ylabel('Actual')
plt.title('Confusion Matrix')
plt.show()

# T√≠nh FPR, TPR cho ƒë∆∞·ªùng cong ROC
fpr, tpr, _ = roc_curve(y_test, y_pred_prob)

# T√≠nh AUC (Area Under the Curve)
roc_auc = auc(fpr, tpr)

# V·∫Ω ƒë∆∞·ªùng cong ROC
plt.figure()
plt.plot(fpr, tpr, color='darkorange', lw=2, label=f'ROC curve (area = {roc_auc:.2f})')
plt.plot([0, 1], [0, 1], color='navy', lw=2, linestyle='--')
plt.xlim([0.0, 1.0])
plt.ylim([0.0, 1.05])
plt.xlabel('False Positive Rate')
plt.ylabel('True Positive Rate')
plt.title('Receiver Operating Characteristic (ROC) Curve')
plt.legend(loc="lower right")
plt.show()
<details>
<summary>Click to expand</summary>
```
![image](https://github.com/user-attachments/assets/d0199511-46e9-4b59-a3f2-18e4c3bee0a8)
Sau khi hu·∫•n luy·ªán m√¥ h√¨nh **Cat Boost**, ch√∫ng ta ki·ªÉm tra m·ª©c ƒë·ªô quan tr·ªçng c·ªßa t·ª´ng ƒë·∫∑c tr∆∞ng (feature) trong d·ª± ƒëo√°n.
![image](https://github.com/user-attachments/assets/e771fef6-4bef-4ce8-a031-19549f46f7a3)
**ƒê√°nh gi√° m√¥ h√¨nh**:
- Catboost ƒë·∫°t ƒë·ªô ch√≠nh x√°c cao nh·∫•t.
- C√°c ƒë·∫∑c tr∆∞ng quan tr·ªçng bao g·ªìm:

Tenure_transformed ‚Äì ƒê·∫∑c tr∆∞ng n√†y c√≥ t·∫ßm quan tr·ªçng cao nh·∫•t, c√≥ th·ªÉ li√™n quan ƒë·∫øn s·ªë nƒÉm kh√°ch h√†ng ƒë√£ g·∫Øn b√≥ v·ªõi d·ªãch v·ª•.
SatisfactionScore ‚Äì ƒêi·ªÉm ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng c·ªßa kh√°ch h√†ng.
WarehouseToHome_transformed ‚Äì Kho·∫£ng c√°ch t·ª´ kho h√†ng ƒë·∫øn nh√† c·ªßa kh√°ch h√†ng.
NumberOfAddress ‚Äì S·ªë l∆∞·ª£ng ƒë·ªãa ch·ªâ ƒë∆∞·ª£c ƒëƒÉng k√Ω b·ªüi kh√°ch h√†ng.
Complain ‚Äì S·ªë l∆∞·ª£ng khi·∫øu n·∫°i c·ªßa kh√°ch h√†ng, c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn quy·∫øt ƒë·ªãnh r·ªùi b·ªè d·ªãch v·ª•.
OrderAmountHikeFromLastYear ‚Äì S·ª± gia tƒÉng s·ªë l∆∞·ª£ng ƒë∆°n h√†ng so v·ªõi nƒÉm tr∆∞·ªõc.
CashbackAmount_transformed ‚Äì S·ªë ti·ªÅn ho√†n l·∫°i m√† kh√°ch h√†ng nh·∫≠n ƒë∆∞·ª£c.
DaySinceLastOrder ‚Äì S·ªë ng√†y k·ªÉ t·ª´ l·∫ßn ƒë·∫∑t h√†ng g·∫ßn nh·∫•t.

## Final Conclusion & Recommendations

‚úÖ T√≥m t·∫Øt k·∫øt qu·∫£ m√¥ h√¨nh:  
‚úîÔ∏è CatBoost ƒë·∫°t ƒë·ªô ch√≠nh x√°c cao nh·∫•t v·ªõi AUC = 0.99, cho th·∫•y m√¥ h√¨nh r·∫•t m·∫°nh m·∫Ω trong vi·ªác ph√¢n lo·∫°i.  
‚úîÔ∏è C√°c ƒë·∫∑c tr∆∞ng quan tr·ªçng ƒë·ªÅu c√≥ √Ω nghƒ©a th·ª±c t·∫ø, li√™n quan ƒë·∫øn tr·∫£i nghi·ªám kh√°ch h√†ng, ph∆∞∆°ng th·ª©c thanh to√°n, h√†nh vi s·ª≠ d·ª•ng d·ªãch v·ª•.  

üöÄ Khuy·∫øn ngh·ªã ƒë·ªÉ c·∫£i thi·ªán churn (Gi·∫£m t·ª∑ l·ªá kh√°ch h√†ng r·ªùi b·ªè)  
D·ª±a tr√™n ph√¢n t√≠ch ƒë·∫∑c tr∆∞ng quan tr·ªçng, c√≥ th·ªÉ ƒë·ªÅ xu·∫•t c√°c chi·∫øn l∆∞·ª£c c·ª• th·ªÉ ƒë·ªÉ c·∫£i thi·ªán tr·∫£i nghi·ªám kh√°ch h√†ng v√† gi·∫£m churn:  

1Ô∏è‚É£ C·∫£i thi·ªán tr·∫£i nghi·ªám kh√°ch h√†ng (Customer Satisfaction)  
üîπ C√° nh√¢n h√≥a d·ªãch v·ª•: D·ª±a v√†o d·ªØ li·ªáu SatisfactionScore, c√≥ th·ªÉ g·ª≠i c√°c ∆∞u ƒë√£i ho·∫∑c ch∆∞∆°ng tr√¨nh chƒÉm s√≥c kh√°ch h√†ng ƒë·∫∑c bi·ªát cho nh√≥m c√≥ ƒëi·ªÉm th·∫•p.  
üîπ Ch·ªß ƒë·ªông x·ª≠ l√Ω khi·∫øu n·∫°i: KH c√≥ khi·∫øu n·∫°i ("Complain") c√≥ nguy c∆° r·ªùi b·ªè cao h∆°n. T·∫°o ƒë·ªôi ng≈© h·ªó tr·ª£ ri√™ng, x·ª≠ l√Ω nhanh c√°c ph·∫£n h·ªìi ti√™u c·ª±c.  
üîπ TƒÉng c∆∞·ªùng ch√≠nh s√°ch ƒë·ªïi tr·∫£ & h·ªó tr·ª£ sau mua ƒë·ªÉ t·∫°o ni·ªÅm tin v√† gi·ªØ ch√¢n kh√°ch h√†ng l√¢u h∆°n.  
2Ô∏è‚É£ T·ªëi ∆∞u logistics & giao h√†ng  
üîπ Kho·∫£ng c√°ch t·ª´ kho ƒë·∫øn nh√† ("WarehouseToHome_transformed") ·∫£nh h∆∞·ªüng l·ªõn ‚Üí TƒÉng s·ªë l∆∞·ª£ng kho g·∫ßn khu v·ª±c c√≥ nhi·ªÅu kh√°ch h√†ng, t·ªëi ∆∞u tuy·∫øn giao h√†ng.  
üîπ T·ªëi ∆∞u th·ªùi gian giao h√†ng: Cam k·∫øt th·ªùi gian giao h√†ng r√µ r√†ng h∆°n, ƒë·∫∑c bi·ªát v·ªõi nh√≥m kh√°ch h√†ng ·ªü xa.  
3Ô∏è‚É£ TƒÉng c∆∞·ªùng loyalty program (Ch∆∞∆°ng tr√¨nh kh√°ch h√†ng th√¢n thi·∫øt)  
üîπ Nh√≥m kh√°ch h√†ng c√≥ th·ªùi gian s·ª≠ d·ª•ng l√¢u d√†i ("Tenure_transformed") c√≥ gi√° tr·ªã cao ‚Üí T·∫°o c√°c ∆∞u ƒë√£i d√†i h·∫°n cho h·ªç, v√≠ d·ª•: gi·∫£m gi√°, t√≠ch ƒëi·ªÉm, g√≥i th√†nh vi√™n VIP.  
üîπ T·∫∑ng cashback (ho√†n ti·ªÅn) cho kh√°ch h√†ng c≈© ƒë·ªÉ gi·ªØ ch√¢n h·ªç ti·∫øp t·ª•c mua s·∫Øm.  
4Ô∏è‚É£ T·ªëi ∆∞u ph∆∞∆°ng th·ª©c thanh to√°n & k√™nh ƒëƒÉng nh·∫≠p  
üîπ Nh·ªØng kh√°ch h√†ng d√πng E-wallet & Credit Card c√≥ h√†nh vi kh√°c bi·ªát ‚Üí T√≠ch h·ª£p nhi·ªÅu h√¨nh th·ª©c thanh to√°n h∆°n, khuy·∫øn m√£i khi d√πng v√≠ ƒëi·ªán t·ª≠.  
üîπ Nh√≥m kh√°ch h√†ng ƒëƒÉng nh·∫≠p b·∫±ng Mobile/Desktop c√≥ h√†nh vi kh√°c nhau ‚Üí T·ªëi ∆∞u UI/UX tr√™n t·ª´ng n·ªÅn t·∫£ng ƒë·ªÉ ph√π h·ª£p h∆°n v·ªõi nh√≥m KH ƒë√≥.  
5Ô∏è‚É£ D·ª± ƒëo√°n & ngƒÉn ch·∫∑n churn b·∫±ng AI  
üîπ D√πng m√¥ h√¨nh d·ª± ƒëo√°n churn (nh∆∞ CatBoost ƒëang tri·ªÉn khai) ƒë·ªÉ nh·∫≠n di·ªán KH c√≥ nguy c∆° r·ªùi b·ªè s·ªõm.  
üîπ G·ª≠i email/SMS nh·∫Øc nh·ªü v·ªõi ∆∞u ƒë√£i ph√π h·ª£p tr∆∞·ªõc khi h·ªç quy·∫øt ƒë·ªãnh r·ªùi b·ªè d·ªãch v·ª•.  
üéØ T√≥m t·∫Øt khuy·∫øn ngh·ªã ch√≠nh  
‚úî C·∫£i thi·ªán tr·∫£i nghi·ªám kh√°ch h√†ng (CSKH t·ªët h∆°n, x·ª≠ l√Ω khi·∫øu n·∫°i nhanh).  
‚úî T·ªëi ∆∞u logistics & giao h√†ng (r√∫t ng·∫Øn th·ªùi gian, m·ªü r·ªông kho).  
‚úî T·∫°o loyalty program (∆∞u ƒë√£i cho KH l√¢u nƒÉm, cashback).  
‚úî C·∫£i thi·ªán ph∆∞∆°ng th·ª©c thanh to√°n & k√™nh truy c·∫≠p.  
‚úî ·ª®ng d·ª•ng AI ƒë·ªÉ nh·∫≠n di·ªán & ngƒÉn ch·∫∑n churn s·ªõm. 



